<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Safety Feud - Host Control</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<style>
  :root { --bg:#0a1b3d; --btn:#1e40af; --hover:#3b82f6; --winA:#10b981; --winB:#8b5cf6; --strike:#ef4444; --used:#666; }
  body { margin:0; padding:20px; background:var(--bg); color:white; font-family:'Segoe UI',sans-serif; min-height:100vh; }
  .container { max-width:1400px; margin:0 auto; }
  h1 { text-align:center; font-size:3.5rem; margin-bottom:30px; color:#00ff88; text-shadow:0 0 20px #00ff88; }
  .question-buttons { display:flex; justify-content:center; gap:20px; margin-bottom:40px; flex-wrap:wrap; }
  .q-btn { padding:20px 40px; font-size:2rem; background:var(--btn); color:white; border:none; border-radius:12px; cursor:pointer; }
  .q-btn:hover { background:var(--hover); }
  .q-btn:disabled { background:#333; cursor:not-allowed; opacity:0.5; }
  .q-btn.used { background:#10b981; opacity:0.8; }
  #questionLabel { font-size:3rem; text-align:center; margin:40px 0; padding:30px; background:#1e293b; border-radius:16px; min-height:120px; }
  .answer-row { display:grid; grid-template-columns:1fr 120px 120px; gap:15px; margin:15px 0; align-items:center; }
  .answer-text { font-size:2.5rem; background:#1e293b; padding:20px; border-radius:12px; text-align:center; }
  .win-btn { padding:15px; font-size:1.8rem; border:none; border-radius:10px; cursor:pointer; }
  .winA { background:var(--winA); color:white; }
  .winB { background:var(--winB); color:white; }
  .win-btn:disabled { background:var(--used); cursor:not-allowed; }
  .strike-buttons { display:grid; grid-template-columns:repeat(6,1fr); gap:15px; margin:40px 0; }
  .strike-btn { padding:20px; font-size:2rem; background:var(--strike); color:white; border:none; border-radius:12px; cursor:pointer; }
  .strike-btn:disabled { background:var(--used); cursor:not-allowed; opacity:0.6; }
  .bottom-buttons { display:flex; justify-content:center; gap:30px; margin-top:50px; flex-wrap:wrap; }
  .action-btn { padding:25px 50px; font-size:2.5rem; border:none; border-radius:16px; cursor:pointer; }
  #revealAll { background:#f59e0b; color:black; }
  #clearTV { background:#6366f1; }
  #reset { background:#ef4444; color:white; }
  .status { text-align:center; font-size:2rem; margin:20px; }
</style>
</head>
<body>

<div class="container">
  <h1>SAFETY FEUD - HOST CONTROL</h1>

  <div class="question-buttons">
    <button class="q-btn" id="q1" onclick="selectQuestion(1)">Q1</button>
    <button class="q-btn" id="q2" onclick="selectQuestion(2)">Q2</button>
    <button class="q-btn" id="q3" onclick="selectQuestion(3)">Q3</button>
    <button class="q-btn" id="q4" onclick="selectQuestion(4)">Q4</button>
    <button class="q-btn" id="q5" onclick="selectQuestion(5)">Q5</button>
    <button class="q-btn" id="q6" onclick="selectQuestion(6)">Q6</button>
  </div>

  <div id="questionLabel">Select a question to begin...</div>

  <div id="answersContainer" style="display:none;">
    <div class="answer-row">
      <div class="answer-text" id="ans1">-</div>
      <button class="win-btn winA" id="winA1" onclick="awardAnswer(1,'A')">A Wins</button>
      <button class="win-btn winB" id="winB1" onclick="awardAnswer(1,'B')">B Wins</button>
    </div>
    <div class="answer-row">
      <div class="answer-text" id="ans2">-</div>
      <button class="win-btn winA" id="winA2" onclick="awardAnswer(2,'A')">A Wins</button>
      <button class="win-btn winB" id="winB2" onclick="awardAnswer(2,'B')">B Wins</button>
    </div>
    <div class="answer-row">
      <div class="answer-text" id="ans3">-</div>
      <button class="win-btn winA" id="winA3" onclick="awardAnswer(3,'A')">A Wins</button>
      <button class="win-btn winB" id="winB3" onclick="awardAnswer(3,'B')">B Wins</button>
    </div>
    <div class="answer-row">
      <div class="answer-text" id="ans4">-</div>
      <button class="win-btn winA" id="winA4" onclick="awardAnswer(4,'A')">A Wins</button>
      <button class="win-btn winB" id="winB4" onclick="awardAnswer(4,'B')">B Wins</button>
    </div>
    <div class="answer-row">
      <div class="answer-text" id="ans5">-</div>
      <button class="win-btn winA" id="winA5" onclick="awardAnswer(5,'A')">A Wins</button>
      <button class="win-btn winB" id="winB5" onclick="awardAnswer(5,'B')">B Wins</button>
    </div>
  </div>

  <div class="strike-buttons" id="strikeButtons" style="display:none;">
    <button class="strike-btn" id="strikeA1" onclick="addStrike('A',1)">A1</button>
    <button class="strike-btn" id="strikeA2" onclick="addStrike('A',2)">A2</button>
    <button class="strike-btn" id="strikeA3" onclick="addStrike('A',3)">A3</button>
    <button class="strike-btn" id="strikeB1" onclick="addStrike('B',1)">B1</button>
    <button class="strike-btn" id="strikeB2" onclick="addStrike('B',2)">B2</button>
    <button class="strike-btn" id="strikeB3" onclick="addStrike('B',3)">B3</button>
  </div>

  <div class="bottom-buttons">
    <button class="action-btn" id="revealAll" onclick="revealAll()" disabled>REVEAL ALL</button>
    <button class="action-btn" id="clearTV" onclick="clearTV()" disabled>CLEAR TV</button>
    <button class="action-btn" id="reset" onclick="resetGame()">RESET</button>
  </div>

  <div class="status">
    Team A Strikes: <span id="strikesA">0</span> | 
    Team B Strikes: <span id="strikesB">0</span>
  </div>
</div>

<script>
const firebaseConfig = 
{
  apiKey: "AIzaSyCOVAn8yy3f6cGonaLNZMcFgvli-5nfu6M",
  authDomain: "safety-feud-online.firebaseapp.com",
  databaseURL: "https://safety-feud-online-default-rtdb.firebaseio.com",
  projectId: "safety-feud-online",
  storageBucket: "safety-feud-online.firebasestorage.app",
  messagingSenderId: "940458931322",
  appId: "1:940458931322:web:7f107ebe8cc761d86b37c3" 
};
firebase.initializeApp(firebaseConfig);
const gameRef = firebase.database().ref('safetyfeud');

const questions = [
  { q: "Name something people worry about when eatin from a buffet", a: ["Gaining Weight","Food Availability","Food Options","Unknown ingredients/ allergies","Food hygiene"], p: [36,27,18,11,8] },
  { q: "Name something people must NOT do during an evacuation", a: ["Panic","Run and push","Go back for belongings","Ignore Instructions","Use Elevators"], p: [38,24,18,12,8] },
  { q: "Name something that makes training boring", a: ["Long presentations","Too much theory","No Interaction","Repeating Old Content","Poor Trainer"], p: [36,25,17,13,9] },
  { q: "Name a body part most often injured at work", a: ["Hand/ Fingers","Back","Legs/ Feet","Eyes","Head"], p: [36,24,19,13,8] },
  { q: "Name something that can get you hacked", a: ["Clicking phising emails","Weak Passwords","Using Public WiFI","Using Unknown USBs","Fake apps/ software"], p: [37,25,16,12,10] },
  { q: "Name something that shows that a company cares about quality", a: ["Certifications (ISO etc.)","Employee Training","Clean & Organized Workplace","Regular Audits","Customer feedback system"], p: [30,26,18,15,11] }
];

let currentQuestionIndex = null;
const usedQuestions = new Set();

// Load used questions on startup
gameRef.child('usedQuestions').once('value', snap => {
  const used = snap.val();
  if (used) {
    Object.keys(used).forEach(key => {
      const num = parseInt(key.replace('q', ''));
      if (!isNaN(num)) {
        usedQuestions.add(num);
        document.getElementById(`q${num}`).classList.add('used');
        document.getElementById(`q${num}`).disabled = true;
      }
    });
  }
});

function selectQuestion(num) {
  if (usedQuestions.has(num)) return;

  currentQuestionIndex = num - 1;
  const q = questions[currentQuestionIndex];

  document.getElementById('questionLabel').textContent = q.q;
  document.getElementById('answersContainer').style.display = 'block';
  document.getElementById('strikeButtons').style.display = 'grid';
  document.getElementById('revealAll').disabled = false;
  document.getElementById('clearTV').disabled = false;

  usedQuestions.add(num);
  document.getElementById(`q${num}`).classList.add('used');
  document.getElementById(`q${num}`).disabled = true;

  for (let i = 1; i <= 5; i++) {
    document.getElementById(`ans${i}`).textContent = q.a[i-1];
  }

  const usedObj = {};
  usedQuestions.forEach(n => usedObj[`q${n}`] = true);

  gameRef.set({
    question: q.q,
    answers: q.a.map((text, i) => ({ text, points: q.p[i], revealed: false, winner: null })),
    strikesA: 0,
    strikesB: 0,
    currentState: 'playing',
    usedQuestions: usedObj
  });
}

function awardAnswer(row, team) {
  const ansEl = document.getElementById(`ans${row}`);
  ansEl.style.background = team === 'A' ? '#10b981' : '#8b5cf6';
  ansEl.style.color = 'white';
  ansEl.textContent += ` → ${team} WINS`;

  document.getElementById(`winA${row}`).disabled = true;
  document.getElementById(`winB${row}`).disabled = true;

  gameRef.child('answers').child(row-1).update({ revealed: true, winner: team });
}

function addStrike(team, num) {
  const current = parseInt(document.getElementById(`strikes${team}`).textContent);
  if (current >= 3) return;

  const newCount = current + 1;
  document.getElementById(`strikes${team}`).textContent = newCount;
  document.getElementById(`strike${team}${num}`).disabled = true;

  gameRef.child(`strikes${team}`).set(newCount);

  if (newCount === 3) {
    const prefix = team === 'A' ? 'winA' : 'winB';
    for (let i = 1; i <= 5; i++) {
      const btn = document.getElementById(`${prefix}${i}`);
      if (!btn.disabled) btn.disabled = true;
    }
  }
}

function revealAll() {
  document.querySelectorAll('.answer-text').forEach(el => {
    el.style.background = '#f59e0b';
    el.style.color = 'black';
  });
  gameRef.child('answers').get().then(s => {
    const arr = s.val();
    arr.forEach(a => a.revealed = true);
    gameRef.child('answers').set(arr);
  });
}

// CLEAR TV — no popup, just works
function clearTV() {
  gameRef.once('value').then(snap => {
    const data = snap.val() || {};
    const used = data.usedQuestions || {};

    gameRef.set({ usedQuestions: used }).then(() => {
      resetRoundUI();
    });
  });
}

function resetRoundUI() {
  document.getElementById('questionLabel').textContent = "Select a question to begin...";
  document.getElementById('answersContainer').style.display = 'none';
  document.getElementById('strikeButtons').style.display = 'none';
  document.getElementById('revealAll').disabled = true;
  document.getElementById('clearTV').disabled = true;

  for (let i = 1; i <= 5; i++) {
    document.getElementById(`ans${i}`).textContent = '-';
    document.getElementById(`ans${i}`).style.background = '';
    document.getElementById(`ans${i}`).style.color = '';
    document.getElementById(`winA${i}`).disabled = false;
    document.getElementById(`winB${i}`).disabled = false;
  }

  document.getElementById('strikesA').textContent = '0';
  document.getElementById('strikesB').textContent = '0';
  document.querySelectorAll('.strike-btn').forEach(btn => btn.disabled = false);
}

function resetGame() {
  if (confirm("Full reset? All questions will be re-enabled.")) {
    gameRef.remove().then(() => location.reload());
  }
}
</script>
</body>
</html>
v
