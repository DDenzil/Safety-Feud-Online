<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Safety Feud Online - HSE Edition</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<style>
  :root {
    --red: #d32f2f; --green: #2e7d32; --blue: #1565c0; --yellow: #f9a825;
    --bg: #0a192f; --card: #16213e; --accent: #00ff88;
  }
  body { margin:0; font-family:'Arial Black',sans-serif; background:var(--bg); color:white; height:100vh; overflow:hidden; }
  #hostView, #playerView { width:100%; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:20px; box-sizing:border-box; }
  #playerView { background:#000; }
  h1 { font-size:5rem; margin:20px; color:var(--accent); text-shadow:0 0 30px var(--accent); }
  .teamsGrid { display:grid; grid-template-columns:repeat(2,1fr); gap:30px; margin:30px; }
  .teamCard { padding:30px; border-radius:20px; text-align:center; font-size:2.5rem; cursor:pointer; transition:0.3s; border:8px solid transparent; }
  .teamCard.selected { border-color:gold; box-shadow:0 0 50px gold; transform:scale(1.05); }
  .red { background:var(--red); }
  .green { background:var(--green); }
  .blue { background:var(--blue); }
  .yellow { background:var(--yellow); }
  #question, #faceoffQ { font-size:3.5rem; margin:40px; padding:30px; background:rgba(0,255,136,0.15); border-radius:20px; text-align:center; min-height:120px; }
  #board { display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:20px; max-width:1200px; margin:30px auto; }
  .answer { background:#000080; border:8px solid white; border-radius:20px; padding:30px; font-size:2.5rem; position:relative; min-height:140px; transition:0.4s; cursor:pointer; }
  .answer.revealed { background:#ffd700; color:black; }
  .answer .num { position:absolute; top:10px; left:20px; font-size:3rem; }
  .answer .txt { margin-top:50px; font-weight:bold; }
  .answer .pts { position:absolute; bottom:15px; right:25px; font-size:4rem; font-weight:bold; }
  #strikes { font-size:8rem; letter-spacing:25px; color:#ff1744; margin:30px; }
  #wrongAnswers { margin:20px; font-size:2rem; color:#ff6b6b; min-height:100px; }
  button { padding:18px 40px; margin:15px; font-size:2rem; border:none; border-radius:15px; cursor:pointer; font-weight:bold; }
  .bigBtn { padding:25px 60px; font-size:3rem; background:var(--accent); color:black; }
  .buzzerBtn { width:90vw; height:80vh; max-width:500px; max-height:500px; border-radius:50%; font-size:6rem; animation:pulse 2s infinite; }
  @keyframes pulse { 0%,100% { transform:scale(1); } 50% { transform:scale(1.1); } }
  input { padding:20px; font-size:2.5rem; width:90%; max-width:600px; margin:20px; border-radius:15px; text-align:center; }
  .hidden { display:none !important; }
</style>
</head>
<body>

<!-- HOST VIEW -->
<div id="hostView">
  <h1>SAFETY FEUD</h1>
  <p style="font-size:2.5rem;color:var(--accent);">HSE Edition</p>

  <div id="teamSelect" class="teamsGrid">
    <div class="teamCard red" data-team="RED">RED TEAM</div>
    <div class="teamCard green" data-team="GREEN">GREEN TEAM</div>
    <div class="teamCard blue" data-team="BLUE">BLUE TEAM</div>
    <div class="teamCard yellow" data-team="YELLOW">YELLOW TEAM</div>
  </div>
  <button class="bigBtn" id="startGameBtn" disabled>SELECT 2 TEAMS TO START</button>

  <div id="gameScreen" class="hidden">
    <div id="faceoffQ">Ready...</div>
    <div id="question"></div>
    <div id="strikes">___</div>
    <div id="wrongAnswers"></div>
    <div id="board"></div>
    <div>
      <button class="bigBtn" onclick="startFaceoff()">START FACE-OFF</button>
      <button onclick="nextRound()">NEXT ROUND</button>
      <button style="background:#ff1744;" onclick="location.reload()">RESET</button>
    </div>
  </div>
</div>

<!-- PLAYER VIEW -->
<div id="playerView">
  <h1>SAFETY FEUD</h1>
  <p style="font-size:2rem;color:var(--accent);">Join Your Team</p>
  <input type="text" id="playerName" placeholder="Your Name" style="margin:20px;">
  <div class="teamsGrid">
    <button class="teamCard red" data-team="RED">JOIN RED</button>
    <button class="teamCard green" data-team="GREEN">JOIN GREEN</button>
    <button class="teamCard blue" data-team="BLUE">JOIN BLUE</button>
    <button class="teamCard yellow" data-team="YELLOW">JOIN YELLOW</button>
  </div>

  <div id="playerGame" class="hidden" style="text-align:center;width:100%;">
    <h2 id="welcomeName"></h2>
    <p id="statusMsg" style="font-size:2.5rem;margin:30px;"></p>
    <button id="buzzBtn" class="buzzerBtn hidden">BUZZ!</button>
    <input type="text" id="answerInput" class="hidden" placeholder="Type answer here">
  </div>
</div>

<script>
// ====== YOUR FIREBASE CONFIG (REPLACE THIS) ======
const firebaseConfig = {
  apiKey: "AIzaSyCOVAn8yy3f6cGonaLNZMcFgvli-5nfu6M",
  authDomain: "safety-feud-online.firebaseapp.com",
  databaseURL: "https://safety-feud-online-default-rtdb.firebaseio.com",
  projectId: "safety-feud-online",
  storageBucket: "safety-feud-online.firebasestorage.app",
  messagingSenderId: "940458931322",
  appId: "1:940458931322:web:7f107ebe8cc761d86b37c3"
};
// ================================================

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const game = db.ref('safetyfeud');

const isHost = location.search.includes('host') || screen.width > 1200;

// Show correct view
document.getElementById('hostView').style.display = isHost ? 'flex' : 'none';
document.getElementById('playerView').style.display = isHost ? 'none' : 'flex';

let myTeam = null, myName = null, isLeader = false;

// ===================== PLAYER LOGIC =====================
if (!isHost) {
  document.querySelectorAll('#playerView .teamCard').forEach(btn => {
    btn.addEventListener('click', () => {
      myName = document.getElementById('playerName').value.trim() || 'Player';
      myTeam = btn.dataset.team;

      // Join team
      const playerRef = game.child(`teams/${myTeam}/players`).push();
      playerRef.set({ name: myName });
      playerRef.onDisconnect().remove();

      // Become leader if first
      game.child(`teams/${myTeam}/leader`).once('value').then(s => {
        if (!s.val()) {
          game.child(`teams/${myTeam}/leader`).set(myName);
          isLeader = true;
        }
      });

      // Switch to game screen
      document.querySelector('#playerView > *:not(#playerGame)').style.display = 'none';
      document.getElementById('playerGame').classList.remove('hidden');
      document.getElementById('welcomeName').textContent = `Welcome ${myName}! (${myTeam} Team)`;
      document.getElementById('statusMsg').textContent = 'Waiting for host...';

      listenToGameState();
    });
  });
}

function listenToGameState() {
  game.child('state').on('value', snap => {
    const state = snap.val() || 'waiting';
    document.getElementById('buzzBtn').classList.add('hidden');
    document.getElementById('answerInput').classList.add('hidden');

    if (state === 'faceoff' && isLeader) {
      document.getElementById('buzzBtn').classList.remove('hidden');
      document.getElementById('statusMsg').textContent = 'FACE-OFF! BUZZ NOW!';
    } else if (state === 'playing') {
      game.child('controlTeam').once('value').then(s => {
        const ctrl = s.val();
        if (ctrl === myTeam) {
          document.getElementById('answerInput').classList.remove('hidden');
          document.getElementById('answerInput').focus();
          document.getElementById('statusMsg').textContent = 'YOUR TEAM HAS CONTROL!';
        } else {
          document.getElementById('statusMsg').textContent = `${ctrl} has control`;
        }
      });
    } else {
      document.getElementById('statusMsg').textContent = 'Waiting for next round...';
    }
  });

  // Buzz button
  document.getElementById('buzzBtn').onclick = () => {
    game.child('buzz').set({ team: myTeam, time: Date.now() });
    document.getElementById('buzzBtn').textContent = 'BUZZED!';
    document.getElementById('buzzBtn').disabled = true;
  };

  // Answer input
  document.getElementById('answerInput').addEventListener('keypress', e => {
    if (e.key === 'Enter' && e.target.value.trim()) {
      game.child('guesses').push({
        team: myTeam,
        name: myName,
        guess: e.target.value.trim().toLowerCase()
      });
      e.target.value = '';
    }
  });
}

// ===================== HOST LOGIC =====================
if (isHost) {
  let selected = [];
  document.querySelectorAll('#teamSelect .teamCard').forEach(card => {
    card.onclick = () => {
      const team = card.dataset.team;
      if (card.classList.contains('selected')) {
        card.classList.remove('selected');
        selected = selected.filter(t => t !== team);
      } else if (selected.length < 2) {
        card.classList.add('selected');
        selected.push(team);
      }
      document.getElementById('startGameBtn').disabled = selected.length !== 2;
      game.child('playingTeams').set(selected);
    };
  });

  window.startGame = () => {
    document.getElementById('teamSelect').style.display = 'none';
    document.getElementById('startGameBtn').style.display = 'none';
    document.getElementById('gameScreen').classList.remove('hidden');
    game.child('state').set('waiting');
  };

  window.startFaceoff = () => {
    game.child('state').set('faceoff');
    document.getElementById('faceoffQ').textContent = 'FACE-OFF IN PROGRESS!';
    game.child('buzz').remove();
  };

  game.child('buzz').on('value', snap => {
    if (!snap.val()) return;
    const buzz = snap.val();
    game.child('controlTeam').set(buzz.team);
    game.child('state').set('playing');
    document.getElementById('faceoffQ').textContent = `${buzz.team} WINS FACE-OFF!`;
    loadQuestion();
  });

  function loadQuestion() {
    const q = {
      q: "Name a common type of PPE",
      a: [
        {t:"Safety Helmet",p:38},{t:"Safety Glasses",p:25},{t:"Gloves",p:18},
        {t:"Steel Toe Boots",p:12},{t:"High-Vis Vest",p:5},{t:"Ear Plugs",p:2}
      ]
    };
    document.getElementById('question').textContent = q.q;
    const board = document.getElementById('board');
    board.innerHTML = '';
    q.a.forEach((ans, i) => {
      const div = document.createElement('div');
      div.className = 'answer hidden';
      div.innerHTML = `<div class="num">${i+1}</div><div class="txt">${ans.t.toUpperCase()}</div><div class="pts">${ans.p}</div>`;
      div.onclick = () => {
        div.classList.remove('hidden');
        div.classList.add('revealed');
      };
      board.appendChild(div);
    });
  }

  window.nextRound = () => {
    game.child('state').set('waiting');
    document.getElementById('faceoffQ').textContent = 'Ready for next face-off...';
  };
}
</script>
</body>
</html>
