<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Safety Feud Online - HSE Edition</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<style>
  :root {
    --red: #d32f2f; --green: #2e7d32; --blue: #1565c0; --yellow: #f9a825;
    --bg: #0a192f; --card: #16213e; --accent: #00ff88;
  }
  body { margin:0; font-family:'Arial Black',sans-serif; background:var(--bg); color:white; height:100vh; overflow:hidden; }
  #hostView, #playerView { width:100%; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:20px; box-sizing:border-box; }
  #playerView { background:#000; }
  h1 { font-size:5rem; margin:20px; color:var(--accent); text-shadow:0 0 30px var(--accent); }
  .teamsGrid { display:grid; grid-template-columns:repeat(2,1fr); gap:30px; margin:30px; }
  .teamCard { padding:30px; border-radius:20px; text-align:center; font-size:2.5rem; cursor:pointer; transition:0.3s; border:8px solid transparent; }
  .teamCard.selected { border-color:gold; box-shadow:0 0 50px gold; transform:scale(1.05); }
  .red { background:var(--red); }
  .green { background:var(--green); }
  .blue { background:var(--blue); }
  .yellow { background:var(--yellow); }
  #question, #faceoffQ { font-size:3.5rem; margin:40px; padding:30px; background:rgba(0,255,136,0.15); border-radius:20px; text-align:center; min-height:120px; }
  #board { display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:20px; max-width:1200px; margin:30px auto; }
  .answer { background:#000080; border:8px solid white; border-radius:20px; padding:30px; font-size:2.5rem; position:relative; min-height:140px; transition:0.4s; cursor:pointer; }
  .answer.revealed { background:#ffd700; color:black; }
  .answer .num { position:absolute; top:10px; left:20px; font-size:3rem; }
  .answer .txt { margin-top:50px; font-weight:bold; }
  .answer .pts { position:absolute; bottom:15px; right:25px; font-size:4rem; font-weight:bold; }
  #strikes { font-size:8rem; letter-spacing:25px; color:#ff1744; margin:30px; }
  #wrongAnswers { margin:20px; font-size:2rem; color:#ff6b6b; min-height:100px; }
  button { padding:18px 40px; margin:15px; font-size:2rem; border:none; border-radius:15px; cursor:pointer; font-weight:bold; }
  .bigBtn { padding:25px 60px; font-size:3rem; background:var(--accent); color:black; }
  .buzzerBtn { width:90vw; height:80vh; max-width:500px; max-height:500px; border-radius:50%; font-size:6rem; animation:pulse 2s infinite; }
  @keyframes pulse { 0%,100% { transform:scale(1); } 50% { transform:scale(1.1); } }
  .hidden { display:none !important; }
  input { padding:20px; font-size:2.5rem; width:90%; max-width:600px; margin:20px; border-radius:15px; text-align:center; }
</style>
</head>
<body>

<!-- HOST VIEW (Projector) -->
<div id="hostView">
  <h1>SAFETY FEUD</h1>
  <p style="font-size:2.5rem;color:var(--accent);">HSE Edition</p>

  <!-- Team Selection -->
  <div id="teamSelect" class="teamsGrid">
    <div class="teamCard red" data-team="RED">RED TEAM</div>
    <div class="teamCard green" data-team="GREEN">GREEN TEAM</div>
    <div class="teamCard blue" data-team="BLUE">BLUE TEAM</div>
    <div class="teamCard yellow" data-team="YELLOW">YELLOW TEAM</div>
  </div>
  <button class="bigBtn" id="startGameBtn" onclick="startGame()" disabled>SELECT 2 TEAMS TO START</button>

  <!-- Game Screen -->
  <div id="gameScreen" class="hidden">
    <div id="faceoffQ"></div>
    <div id="question"></div>
    <div id="strikes">___</div>
    <div id="wrongAnswers"></div>
    <div id="board"></div>
    <button class="bigBtn" onclick="startFaceoff()">START FACE-OFF</button>
    <button onclick="revealAll()">REVEAL ALL ANSWERS</button>
    <button onclick="nextRound()">NEXT ROUND</button>
    <button style="background:#ff1744;" onclick="resetGame()">RESET GAME</button>
  </div>
</div>

<!-- PLAYER VIEW (Phones) -->
<div id="playerView" class="hidden">
  <h1>SAFETY FEUD</h1>
  <input type="text" id="playerName" placeholder="Your Name">
  <div class="teamsGrid">
    <button class="teamCard red" data-team="RED">JOIN RED</button>
    <button class="teamCard green" data-team="GREEN">JOIN GREEN</button>
    <button class="teamCard blue" data-team="BLUE">JOIN BLUE</button>
    <button class="teamCard yellow" data-team="YELLOW">JOIN YELLOW</button>
  </div>

  <div id="waitingScreen" class="hidden">
    <h2 id="welcomeMsg"></h2>
    <p id="roleMsg" style="font-size:2rem;"></p>
    <button id="buzzerBtn" class="hidden buzzerBtn">BUZZ!</button>
    <input type="text" id="answerInput" class="hidden" placeholder="Type your answer...">
  </div>
</div>

<script>
// ====== REPLACE WITH YOUR FIREBASE CONFIG ======
const firebaseConfig = {
  apiKey: "AIzaSyCOVAn8yy3f6cGonaLNZMcFgvli-5nfu6M",
  authDomain: "safety-feud-online.firebaseapp.com",
  databaseURL: "https://safety-feud-online-default-rtdb.firebaseio.com",
  projectId: "safety-feud-online",
  storageBucket: "safety-feud-online.firebasestorage.app",
  messagingSenderId: "940458931322",
  appId: "1:940458931322:web:7f107ebe8cc761d86b37c3"
};
// =============================================

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const game = db.ref('safetyfeud');

const isHost = location.search.includes('host');
document.getElementById('hostView').style.display = isHost ? 'flex' : 'none';
document.getElementById('playerView').style.display = isHost ? 'none' : 'flex';

let myTeam = null, myName = null, isLeader = false;

// HOST: Team Selection
if (isHost) {
  let selectedTeams = [];
  document.querySelectorAll('.teamCard').forEach(card => {
    card.onclick = () => {
      const team = card.dataset.team;
      if (card.classList.contains('selected')) {
        card.classList.remove('selected');
        selectedTeams = selectedTeams.filter(t => t !== team);
      } else if (selectedTeams.length < 2) {
        card.classList.add('selected');
        selectedTeams.push(team);
      }
      document.getElementById('startGameBtn').disabled = selectedTeams.length !== 2;
      game.child('playingTeams').set(selectedTeams);
    };
  });
}

window.startGame = () => {
  document.getElementById('teamSelect').classList.add('hidden');
  document.getElementById('startGameBtn').classList.add('hidden');
  document.getElementById('gameScreen').classList.remove('hidden');
  game.child('state').set('waiting');
};

// PLAYER: Join Team
if (!isHost) {
  document.querySelectorAll('#playerView .teamCard').forEach(btn => {
    btn.onclick = () => {
      myName = document.getElementById('playerName').value.trim() || 'Player';
      myTeam = btn.dataset.team;
      const ref = game.child(`teams/${myTeam}/players`).push();
      ref.set({ name: myName });
      ref.onDisconnect().remove();

      // Become leader if first
      game.child(`teams/${myTeam}/leader`).once('value', s => {
        if (!s.val()) {
          game.child(`teams/${myTeam}/leader`).set(myName);
          isLeader = true;
        }
      });

      document.getElementById('playerView').innerHTML = `
        <h2>Welcome ${myName}!</h2>
        <p style="font-size:3rem;">Team: <span style="color:${myTeam}">${myTeam}</span></p>
        <p id="roleMsg">Waiting for game...</p>
        <button id="buzzerBtn" class="hidden buzzerBtn ${myTeam.toLowerCase()}">BUZZ!</button>
        <input type="text" id="answerInput" class="hidden" placeholder="Type answer...">
      `;

      listenToGame();
    };
  });
}

function listenToGame() {
  game.child('state').on('value', s => {
    const state = s.val();
    document.getElementById('buzzerBtn').classList.add('hidden');
    document.getElementById('answerInput').classList.add('hidden');

    if (state === 'faceoff' && isLeader) {
      document.getElementById('buzzerBtn').classList.remove('hidden');
      document.getElementById('roleMsg').textContent = 'Face-off! Buzz when ready!';
    } else if (state === 'playing') {
      game.child('controlTeam').once('value', c => {
        if (c.val() === myTeam) {
          document.getElementById('answerInput').classList.remove('hidden');
          document.getElementById('answerInput').focus();
          document.getElementById('roleMsg').textContent = 'YOUR TEAM HAS CONTROL!';
        } else {
          document.getElementById('roleMsg').textContent = `${c.val()} has control`;
        }
      });
    }
  });

  // Buzz
  document.getElementById('buzzerBtn').onclick = () => {
    game.child('buzz').set({ team: myTeam, time: Date.now() });
  };

  // Submit answer
  document.getElementById('answerInput').onkeypress = e => {
    if (e.key === 'Enter') {
      const guess = e.target.value.trim();
      if (guess) {
        game.child('guesses').push({ team: myTeam, guess });
        e.target.value = '';
      }
    }
  };
}

// Face-off Questions
const faceoffQs = [
  {q: "What does PPE stand for?", a: ["personal protective equipment", "ppe"]},
  {q: "What does LOTO mean?", a: ["lockout tagout", "lock out tag out", "loto"]},
  {q: "What color is a STOP sign on site?", a: ["red"]},
  {q: "Name a common type of fire extinguisher", a: ["co2", "water", "foam", "powder", "carbon dioxide"]},
  {q: "What should you do before lifting heavy?", a: ["risk assessment", "bend knees", "team lift", "manual handling"]},
];

let currentFaceoff = null;
let currentQuestion = null;

window.startFaceoff = () => {
  currentFaceoff = faceoffQs[Math.floor(Math.random() * faceoffQs.length)];
  document.getElementById('faceoffQ').textContent = "FACE-OFF: " + currentFaceoff.q;
  game.child('state').set('faceoff');
  game.child('buzz').remove();
  game.child('faceoffAnswer').remove();
};

game.child('buzz').on('value', snap => {
  if (!snap.val() || game.child('state').once('value').then(s => s.val()) !== 'faceoff') return;
  const buzz = snap.val();
  game.child('buzzingTeam').set(buzz.team);
  game.child('state').set('faceoff-answer');
  document.getElementById('faceoffQ').textContent = `${buzz.team} buzzed first! Answer the question!`;
});

game.child('faceoffAnswer').on('value', snap => {
  if (!snap.val()) return;
  const ans = snap.val();
  if (currentFaceoff.a.some(a => ans.answer.toLowerCase().includes(a))) {
    game.child('controlTeam').set(ans.team);
    game.child('state').set('playing');
    loadNewQuestion();
  } else {
    const otherTeam = game.child('playingTeams').once('value').then(s => s.val().find(t => t !== ans.team));
    otherTeam.then(t => {
      document.getElementById('faceoffQ').textContent = `Wrong! ${t} gets a chance!`;
      // In real game: allow second team to answer
    });
  }
});

// Main Questions
const questions = [
  {q:"Name a common type of Personal Protective Equipment (PPE)",a:[
    {t:"Safety Helmet",p:38},{t:"Safety Glasses",p:25},{t:"Gloves",p:18},
    {t:"Steel Toe Boots",p:12},{t:"High-Vis Vest",p:5},{t:"Ear Plugs",p:2}
  ]},
  {q:"Name something that must be reported immediately",a:[
    {t:"Accident/Injury",p:45},{t:"Near Miss",p:30},{t:"Unsafe Condition",p:15},
    {t:"Chemical Spill",p:6},{t:"Fire",p:4}
  ]},
  // Add more...
];

function loadNewQuestion() {
  const q = questions[Math.floor(Math.random() * questions.length)];
  currentQuestion = q;
  document.getElementById('question').textContent = q.q;
  document.getElementById('faceoffQ').classList.add('hidden');
  document.getElementById('wrongAnswers').textContent = '';
  const board = document.getElementById('board');
  board.innerHTML = '';
  q.a.forEach((ans, i) => {
    const div = document.createElement('div');
    div.className = 'answer hidden';
    div.innerHTML = `<div class="num">${i+1}</div><div class="txt">${ans.t.toUpperCase()}</div><div class="pts">${ans.p}</div>`;
    div.onclick = () => reveal(i);
    board.appendChild(div);
  });
  game.child('strikes').set(0);
}

function reveal(i) {
  document.querySelectorAll('.answer')[i].classList.remove('hidden');
  document.querySelectorAll('.answer')[i].classList.add('revealed');
}

window.revealAll = () => {
  document.querySelectorAll('.answer').forEach(a => {
    a.classList.remove('hidden');
    a.classList.add('revealed');
  });
};

window.nextRound = () => {
  game.child('state').set('waiting');
  document.getElementById('faceoffQ').classList.remove('hidden');
  document.getElementById('faceoffQ').textContent = "Ready for next face-off...";
};

window.resetGame = () => confirm('Reset?') && location.reload();

game.child('strikes').on('value', s => {
  const n = s.val() || 0;
  document.getElementById('strikes').textContent = 'X'.repeat(n) + '_'.repeat(3-n);
});
</script>
</body>
</html>
