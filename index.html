<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Family Feud - 4 Teams Live!</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<style>
  :root {
    --red: #d32f2f; --green: #388e3c; --blue: #1976d2; --yellow: #f9a825;
  }
  body { margin:0; font-family:'Arial Black',sans-serif; background:#000428; color:white; height:100vh; overflow:hidden; }
  #hostView { display:none; width:100%; height:100%; flex-direction:column; justify-content:center; align-items:center; }
  #phoneView { display:flex; width:100%; height:100%; flex-direction:column; justify-content:center; align-items:center; background:#111; }
  h1 { font-size:5rem; text-shadow:0 0 20px gold; }
  .teams { display:grid; grid-template-columns:1fr 1fr; gap:20px; margin:20px; width:90%; max-width:1200px; }
  .team { padding:30px; border-radius:20px; font-size:2.5rem; text-align:center; min-height:180px; }
  .red    { background:var(--red); }
  .green  { background:var(--green); }
  .blue   { background:var(--blue); }
  .yellow { background:var(--yellow); }
  .leader { box-shadow:0 0 40px gold; transform:scale(1.05); }
  #question { font-size:3rem; margin:30px; min-height:120px; }
  #board { display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:15px; max-width:1100px; margin:30px auto; }
  .answer { background:#000080; border:7px solid white; border-radius:20px; padding:25px; font-size:2.2rem; position:relative; min-height:120px; cursor:pointer; transition:.4s; }
  .answer.revealed { background:#ffd700; color:black; }
  .answer .num { position:absolute; top:8px; left:15px; font-size:2rem; }
  .answer .txt { margin-top:35px; }
  .answer .pts { position:absolute; bottom:10px; right:20px; font-size:3rem; font-weight:bold; }
  #strikes { font-size:7rem; letter-spacing:20px; margin:20px; }
  #buzzer { width:90vw; height:90vh; max-width:500px; max-height:500px; border-radius:50%; font-size:6rem; border:none; color:white; animation:pulse 1.5s infinite; }
  @keyframes pulse { 0%,100% { transform:scale(1); } 50% { transform:scale(1.1); } }
  .redB    { background:var(--red); }
  .greenB  { background:var(--green); }
  .blueB   { background:var(--blue); }
  .yellowB { background:var(--yellow); }
  button { padding:15px 30px; margin:10px; font-size:1.8rem; border:none; border-radius:12px; cursor:pointer; }
  .big { padding:25px 60px; font-size:2.5rem; background:#ff1744; }
  .hidden { display:none !important; }
</style>
</head>
<body>

<!-- PHONE VIEW (what players see on mobile) -->
<div id="phoneView">
  <h1>FAMILY FEUD</h1>
  <p style="font-size:2rem;">Enter your name and pick your team</p>
  <input type="text" id="playerName" placeholder="Your name" style="padding:15px;font-size:1.5rem;width:80%;max-width:400px;margin:10px;">
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;width:90%;max-width:500px;">
    <button class="buzzer redB"    data-team="RED">RED</button>
    <button class="buzzer greenB"  data-team="GREEN">GREEN</button>
    <button class="buzzer blueB"   data-team="BLUE">BLUE</button>
    <button class="buzzer yellowB" data-team="YELLOW">YELLOW</button>
  </div>
  <div id="waiting" class="hidden">
    <h2>Welcome <span id="welcomeName"></span>!</h2>
    <p>You are on <b><span id="teamColor"></span></b> team</p>
    <p id="leaderText" style="font-size:1.8rem;"></p>
    <button id="bigBuzzer" class="hidden">TAP TO BUZZ!</button>
  </div>
</div>

<!-- HOST / PROJECTOR VIEW -->
<div id="hostView">
  <h1 id="question">Waiting for players...</h1>
  <div class="teams">
    <div id="teamRED"    class="team red">RED<br>Score: <span>0</span></div>
    <div id="teamGREEN"  class="team green">GREEN<br>Score: <span>0</span></div>
    <div id="teamBLUE"   class="team blue">BLUE<br>Score: <span>0</span></div>
    <div id="teamYELLOW" class="team yellow">YELLOW<br>Score: <span>0</span></div>
  </div>
  <div id="strikes">___</div>
  <div id="board"></div>
  <div>
    <button onclick="adminStartFaceoff()">START FACE-OFF</button>
    <button onclick="adminNextRound()">NEXT ROUND</button>
    <button class="big" onclick="resetGame()">RESET GAME</button>
  </div>
</div>

<script>
// ======== CONFIGURE YOUR OWN FIREBASE (free) ========
const firebaseConfig = {
  apiKey: "AIzaSyCOVAn8yy3f6cGonaLNZMcFgvli-5nfu6M",
  authDomain: "safety-feud-online.firebaseapp.com",
  databaseURL: "https://safety-feud-online-default-rtdb.firebaseio.com",
  projectId: "safety-feud-online",
  storageBucket: "safety-feud-online.firebasestorage.app",
  messagingSenderId: "940458931322",
  appId: "1:940458931322:web:7f107ebe8cc761d86b37c3"
};
// ====================================================

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const gameRef = db.ref('game');

const teams = ['RED','GREEN','BLUE','YELLOW'];
let myTeam = null;
let myName = null;
let isLeader = false;

// Detect if this is the big screen (URL contains ?host or screen is large)
const isHost = window.location.search.includes('host') || screen.width > 1000;
if (isHost) {
  document.getElementById('phoneView').style.display = 'none';
  document.getElementById('hostView').style.display = 'flex';
  startHostView();
} else {
  document.getElementById('hostView').classList.add('hidden');
}

// ===================== PHONE VIEW =====================
document.querySelectorAll('.buzzer').forEach(btn => {
  btn.addEventListener('click', () => {
    myName = document.getElementById('playerName').value.trim() || 'Player';
    myTeam = btn.dataset.team;
    joinTeam(myTeam, myName);
  });
});

function joinTeam(team, name) {
  const playerRef = db.ref(`teams/${team}/players`).push();
  playerRef.set({ name, joinedAt: Date.now() });
  playerRef.onDisconnect().remove();

  // Check if I'm the first → leader
  db.ref(`teams/${team}/leader`).once('value', snap => {
    if (!snap.exists()) {
      db.ref(`teams/${team}/leader`).set(name);
      isLeader = true;
    }
  });

  document.getElementById('phoneView').innerHTML = `
    <h2>Welcome ${name}!</h2>
    <p>You are on <b style="color:${team}">${team}</b> team</p>
    <p id="leaderText">${isLeader ? 'You are the LEADER!<br>Tap when ready!' : 'Waiting for leader...'}</p>
    <button id="bigBuzzer" class="${team.toLowerCase()}B hidden" style="background:var(--${team.toLowerCase()})">TAP TO BUZZ!</button>
  `;

  // Listen for face-off start
  gameRef.child('faceoff').on('value', snap => {
    if (snap.val() === true && isLeader) {
      document.getElementById('bigBuzzer').classList.remove('hidden');
    } else {
      document.getElementById('bigBuzzer').classList.add('hidden');
    }
  });

  // Buzzer
  document.getElementById('bigBuzzer').onclick = () => {
    const now = Date.now();
    gameRef.child('buzz').set({ team, name, time: now });
    document.getElementById('bigBuzzer').textContent = 'BUZZED!';
    document.getElementById('bigBuzzer').disabled = true;
  };
}

// ===================== HOST VIEW =====================
function startHostView() {
  // Update team scores & leaders
  teams.forEach(t => {
    db.ref(`teams/${t}`).on('value', snap => {
      const data = snap.val() || {};
      const leader = data.leader || '—';
      const players = Object.values(data.players || {}).map(p=>p.name);
      const score = data.score || 0;
      document.querySelector(`#team${t} span`).textContent = score;
      document.getElementById(`team${t}`).innerHTML = `${t}<br>Leader: ${leader}<br>Score: <span>${score}</span>`;
      if (data.leader) document.getElementById(`team${t}`).classList.add('leader');
    });
  });

  // Face-off winner
  gameRef.child('buzz').on('value', snap => {
    if (!snap.val()) return;
    const buzz = snap.val();
    gameRef.child('controllingTeam').set(buzz.team);
    gameRef.child('faceoff').set(false);
    gameRef.child('buzz').remove();
    setTimeout(() => alert(`${buzz.team} wins face-off!`), 300);
  });

  // Load new round when controllingTeam changes
  gameRef.child('controllingTeam').on('value', snap => {
    const team = snap.val();
    if (team) loadNewQuestion();
  });
}

const questions = [
  {q:"Name something you find in a glove compartment",a:[{t:"Insurance/Registration",p:32},{t:"Map",p:18},{t:"Sunglasses",p:15},{t:"Napkins",p:12},{t:"Pen",p:8},{t:"Flashlight",p:7}]},
  {q:"Name a reason a kid might get in trouble at school",a:[{t:"Talking",p:35},{t:"Fighting",p:20},{t:"Chewing Gum",p:15},{t:"Late",p:12},{t:"Not Doing Homework",p:10}]},
  {q:"Name something people lose often",a:[{t:"Keys",p:45},{t:"Phone",p:25},{t:"Wallet",p:15},{t:"Glasses",p:8},{t:"Remote",p:5}]},
  {q:"Name a popular ice cream flavor",a:[{t:"Vanilla",p:40},{t:"Chocolate",p:30},{t:"Strawberry",p:12},{t:"Cookies & Cream",p:8},{t:"Mint Chip",p:6}]},
  {q:"Name something you do on a roller coaster",a:[{t:"Scream",p:55},{t:"Hands Up",p:20},{t:"Close Eyes",p:12},{t:"Laugh",p:8},{t:"Hold On",p:5}]}
];
let currentAnswers = [];

function loadNewQuestion() {
  const q = questions[Math.floor(Math.random()*questions.length)];
  currentAnswers = q.a;
  document.getElementById('question').textContent = q.q;
  const board = document.getElementById('board');
  board.innerHTML = '';
  q.a.forEach((ans,i) => {
    const div = document.createElement('div');
    div.className = 'answer hidden';
    div.innerHTML = `<div class="num">${i+1}</div><div class="txt">${ans.t.toUpperCase()}</div><div class="pts">${ans.p}</div>`;
    div.onclick = () => revealAnswer(i);
    board.appendChild(div);
  });
  gameRef.child('strikes').set(0);
  updateStrikes(0);
}

// Reveal answer (host clicks or admin types)
function revealAnswer(i) {
  if (document.querySelectorAll('.answer')[i].classList.contains('revealed')) return;
  document.querySelectorAll('.answer')[i].classList.remove('hidden');
  document.querySelectorAll('.answer')[i].classList.add('revealed');

  const team = gameRef.child('controllingTeam').once('value').then(s=>s.val());
  team.then(t => {
    db.ref(`teams/${t}/score`).transaction(s => (s||0) + currentAnswers[i].p);
  });
}

// Admin controls
window.adminStartFaceoff = () => gameRef.child('faceoff').set(true);
window.adminNextRound = () => gameRef.child('controllingTeam').set(null);
window.resetGame = () => { if(confirm('Reset entire game?')) location.reload(); };

// Strikes (you can add wrong-answer logic here)
gameRef.child('strikes').on('value', snap => {
  const s = snap.val() || 0;
  updateStrikes(s);
});
function updateStrikes(n) {
  document.getElementById('strikes').textContent = 'X'.repeat(n) + '_'.repeat(3-n);
}
</script>
</body>
</html>
