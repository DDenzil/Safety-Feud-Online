<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Safety Feud - Physical Buzzer Edition</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<style>
  :root { --red:#d32f2f; --green:#2e7d32; --blue:#1565c0; --yellow:#f9a825; --gold:#ffd700; --accent:#00ff88; --bg:#0a192f; }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { margin:0; font-family:'Arial Black',sans-serif; background:var(--bg); color:white; height:100vh; overflow:hidden; position:relative; display:flex; flex-direction:column; align-items:center; justify-content:center; }
  #version { position:absolute; top:10px; right:15px; font-size:1.4rem; color:#0f0; z-index:1000; font-weight:bold; background:rgba(0,0,0,0.5); padding:5px 10px; border-radius:8px; }
  h1 { font-size:6rem; color:var(--accent); text-shadow:0 0 40px var(--accent); margin:30px; }
  #faceoffQ, #question { font-size:4.5rem; margin:40px; padding:40px; background:rgba(255,255,0,0.2); border-radius:30px; text-align:center; min-height:150px; }
  #board { display:grid; grid-template-columns:repeat(2,1fr); gap:30px; max-width:1400px; margin:50px auto; }
  .answer { background:#000080; border:10px solid white; border-radius:25px; padding:50px; font-size:5rem; text-align:center; min-height:200px; cursor:pointer; transition:0.4s; position:relative; }
  .answer.revealed { background:var(--gold); color:black; font-weight:bold; }
  .answer .num { position:absolute; top:20px; left:25px; font-size:4rem; color:white; }
  .answer.revealed .num { color:black; }
  #strikes { font-size:12rem; letter-spacing:40px; color:#ff1744; margin:50px; }
  .teamScore { font-size:4rem; margin:20px; padding:20px; border-radius:20px; min-width:300px; }
  .redScore { background:var(--red); }
  .greenScore { background:var(--green); }
  .blueScore { background:var(--blue); }
  .yellowScore { background:var(--yellow); }
  .buzzerIndicator { width:150px; height:150px; border-radius:50%; background:#333; margin:20px; }
  .buzzed { background:#ff1744 !important; box-shadow:0 0 80px #ff1744; animation:pulse 1s infinite; }
  @keyframes pulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.3)} }
  button { padding:25px 60px; margin:20px; font-size:3rem; border:none; border-radius:20px; cursor:pointer; font-weight:bold; }
  .bigBtn { background:var(--accent); color:black; }
  .clearBtn { background:#ff1744; color:white; }
  .hidden { display:none !important; }
</style>
</head>
<body>

<div id="version">v4.0.0 - Physical Buzzer</div>

<!-- TV DISPLAY (everyone sees) -->
<div id="tvDisplay">
  <h1>SAFETY FEUD</h1>
  <p style="font-size:3rem; color:var(--accent);">HSE Edition</p>

  <!-- Face-off Question -->
  <div id="faceoffQ">Ready for Face-Off...</div>

  <!-- Main Question -->
  <div id="question"></div>

  <!-- Strikes -->
  <div id="strikes">___</div>

  <!-- Answer Board (5 answers) -->
  <div id="board"></div>

  <!-- Team Scores -->
  <div style="display:flex; justify-content:center; gap:50px; margin:40px;">
    <div class="teamScore redScore" id="redScore">RED: 0</div>
    <div class="teamScore greenScore" id="greenScore">GREEN: 0</div>
    <div class="teamScore blueScore" id="blueScore">BLUE: 0</div>
    <div class="teamScore yellowScore" id="yellowScore">YELLOW: 0</div>
  </div>

  <!-- Buzzer Indicators (shows which team buzzed) -->
  <div style="display:flex; justify-content:center; gap:40px; margin:30px;">
    <div class="buzzerIndicator" id="redBuzz"></div>
    <div class="buzzerIndicator" id="greenBuzz"></div>
    <div class="buzzerIndicator" id="blueBuzz"></div>
    <div class="buzzerIndicator" id="yellowBuzz"></div>
  </div>
</div>

<!-- HOST CONTROL PANEL (only host sees) -->
<div id="hostControl" class="hidden">
  <h1>HOST CONTROL</h1>
  <p style="font-size:2.5rem;">Safety Feud - Physical Buzzer Mode</p>

  <button class="clearBtn" onclick="clearDatabase()">CLEAR DATABASE & START FRESH</button>

  <div style="margin:40px;">
    <button class="bigBtn" onclick="startFaceoff()">START FACE-OFF</button>
    <button class="bigBtn" style="background:#ffd700;color:black;" onclick="revealAll()">REVEAL ALL ANSWERS</button>
    <button class="bigBtn" onclick="nextRound()">NEXT ROUND</button>
  </div>

  <div style="font-size:2rem; margin:30px;">
    <p>Current Round Score: <span id="roundScore">0</span></p>
    <p>Controlling Team: <span id="controlTeam">None</span></p>
  </div>
</div>

<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyCOVAn8yy3f6cGonaLNZMcFgvli-5nfu6M",
  authDomain: "safety-feud-online.firebaseapp.com",
  databaseURL: "https://safety-feud-online-default-rtdb.firebaseio.com",
  projectId: "safety-feud-online",
  storageBucket: "safety-feud-online.firebasestorage.app",
  messagingSenderId: "940458931322",
  appId: "1:940458931322:web:7f107ebe8cc761d86b37c3"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const gameRef = db.ref('safetyfeud');

// Detect mode
const isTV = location.pathname.includes('/tv') || location.search.includes('tv');
const isHost = location.pathname.includes('/host') || location.search.includes('host');

if (isTV) {
  document.getElementById('tvDisplay').style.display = 'flex';
  document.getElementById('hostControl').style.display = 'none';
} else if (isHost) {
  document.getElementById('tvDisplay').style.display = 'none';
  document.getElementById('hostControl').style.display = 'flex';
} else {
  alert("Open /tv for display or /host for control panel");
}

// Questions (5 answers only)
const questions = [
  { q: "Name a common type of PPE", a: [
    {t:"Safety Helmet",p:38},{t:"Safety Glasses",p:25},{t:"Gloves",p:18},
    {t:"Steel Toe Boots",p:12},{t:"High-Vis Vest",p:7}
  ]},
  { q: "Name something that must be reported immediately", a: [
    {t:"Accident/Injury",p:45},{t:"Near Miss",p:30},{t:"Unsafe Condition",p:15},
    {t:"Chemical Spill",p:6},{t:"Fire",p:4}
  ]},
  { q: "Name a step in the hierarchy of control", a: [
    {t:"Elimination",p:40},{t:"Substitution",p:25},{t:"Engineering Controls",p:15},
    {t:"Administrative",p:12},{t:"PPE",p:8}
  ]}
];

// Listen to buzz (physical buzzer â†’ any team presses their buzzer)
gameRef.child('buzz').on('value', snap => {
  if (!snap.val()) return;
  const b = snap.val();
  const team = b.team;
  document.getElementById(`${team.toLowerCase()}Buzz`).classList.add('buzzed');
  setTimeout(() => {
    document.querySelectorAll('.buzzerIndicator').forEach(el => el.classList.remove('buzzed'));
  }, 3000);
  gameRef.child('controlTeam').set(team);
  gameRef.child('buzz').remove();
});

// Start face-off
window.startFaceoff = () => {
  const q = questions[Math.floor(Math.random() * questions.length)];
  gameRef.child('currentQuestion').set(q);
  gameRef.child('state').set('faceoff');
  document.getElementById('faceoffQ').textContent = "FACE-OFF! BUZZ IN!";
};

// Load question on TV
gameRef.child('currentQuestion').on('value', snap => {
  const q = snap.val();
  if (!q) return;
  document.getElementById('question').textContent = q.q;
  const board = document.getElementById('board');
  board.innerHTML = '';
  q.a.forEach((ans, i) => {
    const div = document.createElement('div');
    div.className = 'answer';
    div.innerHTML = `<div class="num">${i+1}</div>`;
    div.onclick = () => {
      div.classList.add('revealed');
      div.innerHTML = `<div class="num">${i+1}</div>${ans.t.toUpperCase()}<br><strong>${ans.p}</strong>`;
    };
    board.appendChild(div);
  });
});

// Reveal all
window.revealAll = () => document.querySelectorAll('.answer').forEach(a => a.click());

// Next round
window.nextRound = () => {
  gameRef.child('state').set('ready');
  gameRef.child('currentQuestion').remove();
  document.getElementById('faceoffQ').textContent = 'Ready for next face-off...';
  document.getElementById('board').innerHTML = '';
  document.getElementById('question').textContent = '';
};

// Clear database
window.clearDatabase = () => {
  if (confirm('Clear everything and start fresh?')) {
    gameRef.remove().then(() => location.reload());
  }
};
</script>
</body>
</html>
